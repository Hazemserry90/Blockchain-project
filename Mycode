// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0; 
// Solidity version and license

contract CertificateSystem {

    address public admin; 
    // The admin (university) who deployed the contract

    struct Certificate {
        string studentName;     // Name of the student
        string courseName;      // Course title
        string issueDate;       // Issuance date
        bool isIssued;          // True when the certificate exists
    }

    mapping(address => Certificate) public certificates; 
    // Maps student wallet address â†’ Certificate details

    event CertificateIssued(address indexed student, string studentName, string courseName); 
    // Event emitted when a certificate is created

    event CertificateUpdated(address indexed student, string newCourseName, string newDate);  
    // Event emitted when an existing certificate is updated


    constructor() {
        admin = msg.sender; 
        // Set contract creator as admin
    }


    modifier onlyAdmin() {
        require(msg.sender == admin, "Only admin can perform this action");
        // Restrict function so only admin can call it
        _;
    }


    // ---------------------------------------------------------
    // ISSUE CERTIFICATE
    // ---------------------------------------------------------
    function issueCertificate(
        address _student,
        string memory _studentName,
        string memory _courseName,
        string memory _issueDate
    ) external onlyAdmin {

        require(!certificates[_student].isIssued, "Certificate already issued for this student");
        // Prevent issuing a second certificate to the same student

        certificates[_student] = Certificate({
            studentName: _studentName,
            courseName: _courseName,
            issueDate: _issueDate,
            isIssued: true
        });
        // Save new certificate details on the blockchain

        emit CertificateIssued(_student, _studentName, _courseName);
        // Trigger event confirming issuance
    }


    // ---------------------------------------------------------
    // UPDATE EXISTING CERTIFICATE
    // ---------------------------------------------------------
    function updateCertificate(
        address _student,
        string memory _newCourseName,
        string memory _newIssueDate
    ) external onlyAdmin {

        require(certificates[_student].isIssued, "Cannot update. Certificate does not exist.");
        // Only update if the certificate already exists

        certificates[_student].courseName = _newCourseName;
        certificates[_student].issueDate = _newIssueDate;
        // Overwrite old values with new updated info

        emit CertificateUpdated(_student, _newCourseName, _newIssueDate);
        // Event to notify blockchain listeners
    }


    // ---------------------------------------------------------
    // VIEW CERTIFICATE DETAILS
    // ---------------------------------------------------------
    function getCertificate(address _student)
        external
        view
        returns (string memory, string memory, string memory)
    {
        require(certificates[_student].isIssued, "No certificate found for this address");
        // Prevent reading non-existing certificates

        Certificate memory cert = certificates[_student];
        // Load struct into memory for access

        return (cert.studentName, cert.courseName, cert.issueDate);
        // Return certificate details
    }


    // ---------------------------------------------------------
    // VERIFY CERTIFICATE EXISTS
    // ---------------------------------------------------------
    function verifyCertificate(address _student) external view returns (bool) {
        return certificates[_student].isIssued;
        // Returns true or false depending on certificate existence
    }
}
